import { useMutation, useQueryClient } from '@tanstack/react-query'
import api from '../api'

// Hook para executar aÃ§Ãµes no terreno: plantar, regar e colher
export function useTerrainActions() {
  const queryClient = useQueryClient()

  const plantar = useMutation({
    mutationFn: async (terrainId) => {
      await api.post('/whatsapp/message', { command: 'plantar', terrain_id: terrainId })
    },
    onSuccess: (_data, terrainId) => {
      queryClient.invalidateQueries(['terrains'])
      queryClient.invalidateQueries(['terrain', terrainId])
      queryClient.invalidateQueries(['agents', terrainId])
    },
  })

  const regar = useMutation({
    mutationFn: async (terrainId) => {
      await api.post('/whatsapp/message', { command: 'regar', terrain_id: terrainId })
    },
    onSuccess: (_data, terrainId) => {
      queryClient.invalidateQueries(['terrains'])
      queryClient.invalidateQueries(['terrain', terrainId])
      queryClient.invalidateQueries(['agents', terrainId])
    },
  })

  const colher = useMutation({
    mutationFn: async (terrainId) => {
      await api.post('/whatsapp/message', { command: 'colher', terrain_id: terrainId })
    },
    onSuccess: (_data, terrainId) => {
      queryClient.invalidateQueries(['terrains'])
      queryClient.invalidateQueries(['terrain', terrainId])
      queryClient.invalidateQueries(['agents', terrainId])
    },
  })

  return { plantar, regar, colher }
}
